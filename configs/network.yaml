# ============================================================================
# Multi-Subscription Network Configuration - Azure Landing Zones
# ============================================================================
# Production-ready hub-spoke network deployment across multiple subscriptions
# Uses Azure Verified Modules (AVM) for enhanced security and compliance

schema_version: 2

# Global settings applied to all resources
global:
  naming_prefix: ""
  default_location: "westeurope"
  enable_diagnostics: false

# Hub Networks (matching bootstrap configuration)
hubs:
  - name: "hub-westeurope"
    subscription_id: "b79d5529-469b-4089-a5eb-ede783f663ea"
    resource_group: "rg-hub-westeurope-network"
    location: "westeurope"
    
    # Hub virtual network
    vnet:
      name: "vnet-hub-westeurope"
      address_space: ["10.0.0.0/16"]
      subnets:
        # Required for Azure Firewall
        - name: "AzureFirewallSubnet"
          address_prefixes: ["10.0.0.0/26"]
        # Gateway subnet for VPN/ExpressRoute
        - name: "GatewaySubnet"
          address_prefixes: ["10.0.1.0/27"]
        # Shared services subnet
        - name: "snet-shared-services"
          address_prefixes: ["10.0.2.0/24"]
          service_endpoints: ["Microsoft.Storage", "Microsoft.KeyVault"]
        # Management subnet
        - name: "snet-management"
          address_prefixes: ["10.0.3.0/24"]
    
    # Azure Firewall configuration
    firewall:
      enabled: true
      name: "afw-hub-westeurope"
      sku_tier: "Standard"
      
      # Outbound connectivity method
      outbound_method: "nat_gateway"
      
      # NAT Gateway configuration
      nat_gateway:
        name: "natgw-hub-westeurope"
        public_ip_count: 1
        idle_timeout_minutes: 4
        zones: ["1"]
      
      # Firewall policy
      policy:
        name: "afwp-hub-westeurope"
        threat_intel_mode: "Alert"
        private_ranges: ["IANAPrivateRanges"]
        dns_proxy_enabled: true
        dns_servers: []
        
        # Firewall rules (simplified)
        rules:
          application_rules: []
          network_rules: []
          nat_rules: []

# Spoke Networks (matching bootstrap configuration)
spokes:
  # spoke1 (matches bootstrap config)
  - name: "spoke1"
    subscription_id: "3b532a46-70cc-4b89-ac02-ed77b7ab8d92"
    resource_group: "rg-spoke1-network"
    location: "westeurope"
    
    # Virtual network configuration
    vnet:
      name: "vnet-spoke1"
      address_space: ["10.1.0.0/16"]
      subnets:
        - name: "snet-spoke1-web"
          address_prefixes: ["10.1.1.0/24"]
          route_to_firewall: true
          service_endpoints: ["Microsoft.Storage"]
        - name: "snet-spoke1-app"
          address_prefixes: ["10.1.2.0/24"]
          route_to_firewall: true
        - name: "snet-spoke1-data"
          address_prefixes: ["10.1.3.0/24"]
          route_to_firewall: true
    
    # Connectivity settings (required by module)
    connectivity:
      hub_name: "hub-westeurope"
      enable_peering: true
      allow_forwarded_traffic: true
      use_remote_gateways: false

  # spoke2 (matches bootstrap config)
  - name: "spoke2"
    subscription_id: "951bf7d9-1e2b-4897-8ad7-cb06c80e456a"
    resource_group: "rg-spoke2-network"
    location: "westeurope"
    
    # Virtual network configuration
    vnet:
      name: "vnet-spoke2"
      address_space: ["10.2.0.0/16"]
      subnets:
        - name: "snet-spoke2-web"
          address_prefixes: ["10.2.1.0/24"]
          route_to_firewall: true
          service_endpoints: ["Microsoft.Storage"]
        - name: "snet-spoke2-app"
          address_prefixes: ["10.2.2.0/24"]
          route_to_firewall: true
        - name: "snet-spoke2-data"
          address_prefixes: ["10.2.3.0/24"]
          route_to_firewall: true
    
    # Connectivity settings (required by module)
    connectivity:
      hub_name: "hub-westeurope"
      enable_peering: true
      allow_forwarded_traffic: true
      use_remote_gateways: false